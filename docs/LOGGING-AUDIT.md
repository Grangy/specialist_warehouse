# –ê—É–¥–∏—Ç –ª–æ–≥–æ–≤ (out.log)

## –ü—Ä–æ–±–ª–µ–º–∞
–§–∞–π–ª `out.log` –¥–æ—Å—Ç–∏–≥–∞–ª ~1.37M —Å—Ç—Ä–æ–∫ –∏–∑‚Äë–∑–∞ —á–∞—Å—Ç—ã—Ö –∏ –æ–±—ä—ë–º–Ω—ã—Ö –ª–æ–≥–æ–≤ –Ω–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å.

## –ß—Ç–æ –æ—Ç–∫–ª—é—á–µ–Ω–æ / —Å–æ–∫—Ä–∞—â–µ–Ω–æ

### 1. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å)
- **–£–±—Ä–∞–Ω–æ:** `[API Auth] –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ cookies/–∑–∞–≥–æ–ª–æ–≤–∫–∏/—Ç–µ–ª–æ`, `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ cookies`
- **–§–∞–π–ª—ã:** `src/lib/middleware.ts`, `src/app/api/shipments/route.ts`

### 2. –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ (GET /api/shipments)
- **–£–±—Ä–∞–Ω–æ:** `[API] –ù–∞–π–¥–µ–Ω–æ –∑–∞–∫–∞–∑–æ–≤ –≤ –ë–î`, `–§–∏–ª—å—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞–Ω–∏–π`, `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ò–º—è (—Ä–æ–ª—å)`
- **–£–±—Ä–∞–Ω–æ:** `[COLLECTOR SERVER AUDIT]` ‚Äî –ø–æ –∫–∞–∂–¥–æ–º—É –∑–∞–ø—Ä–æ—Å—É —Å–±–æ—Ä—â–∏–∫–∞
- **–§–∞–π–ª:** `src/app/api/shipments/route.ts`

### 3. –§—Ä–æ–Ω—Ç–µ–Ω–¥ ‚Äî —Ñ–∏–ª—å—Ç—Ä –¥–ª—è —Å–±–æ—Ä—â–∏–∫–æ–≤
- **–£–±—Ä–∞–Ω–æ:** –≤—Å–µ `[COLLECTOR FILTER AUDIT]` –∏ `[COLLECTOR FRONTEND AUDIT]` (–ª–æ–≥–∏ –Ω–∞ –∫–∞–∂–¥–æ–µ –∑–∞–¥–∞–Ω–∏–µ –ø—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏)
- **–§–∞–π–ª:** `src/hooks/useShipments.ts`

### 4. Sync-1C (POST /api/shipments/sync-1c)
- **–ë—ã–ª–æ:** –ø–æ–ª–Ω—ã–π –¥–∞–º–ø –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤, —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞ (–≤—Å–µ orders), –ø–æ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–µ ¬´–∑–∞–∫–∞–∑ –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω / –Ω–∞–π–¥–µ–Ω / —É–∂–µ –ø–æ–º–µ—á–µ–Ω¬ª, –¥–≤–∞ –±–æ–ª—å—à–∏—Ö –¥–∞–º–ø–∞ ¬´–î–ò–ê–ì–ù–û–°–¢–ò–ö–ê: –í—Å–µ –∑–∞–∫–∞–∑—ã processed¬ª, –¥–µ—Ç–∞–ª–∏ –ø–æ –∫–∞–∂–¥–æ–º—É –∑–∞–∫–∞–∑—É –∏ —Å—Ç—Ä–æ–∫–∞–º, –∏—Ç–æ–≥–æ–≤—ã–π JSON –æ—Ç–≤–µ—Ç–∞
- **–°—Ç–∞–ª–æ:** –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ –Ω–∞ –∑–∞–ø—Ä–æ—Å: `[Sync-1C] [id] POST N orders from IP`; –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –≥–æ—Ç–æ–≤—ã—Ö –∫ –≤—ã–≥—Ä—É–∑–∫–µ ‚Äî `ready for export: K`; —Ç–æ–ª—å–∫–æ `console.warn` –ø—Ä–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö/–Ω–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–∞—Ö; –≤ catch ‚Äî –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ —Å `error.message`
- **–§–∞–π–ª:** `src/app/api/shipments/sync-1c/route.ts`

### 5. Ready-For-Export (GET –æ—Ç 1–°)
- **–ë—ã–ª–æ:** —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å, URL, –º–µ—Ç–æ–¥, –ø–æ–ª–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏, query, –ø–æ –∫–∞–∂–¥–æ–º—É –∑–∞–∫–∞–∑—É/–ø–æ–∑–∏—Ü–∏–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫, –∏—Ç–æ–≥–æ–≤—ã–π JSON –æ—Ç–≤–µ—Ç–∞
- **–°—Ç–∞–ª–æ:** –ø—Ä–∏ `readyOrders.length > 0` ‚Äî –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞: `[Ready-For-Export] [id] N orders from IP`; –≤ catch ‚Äî –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ —Å –æ—à–∏–±–∫–æ–π
- **–§–∞–π–ª:** `src/app/api/shipments/ready-for-export/route.ts`

### 6. API Confirm (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞)
- **–£–±—Ä–∞–Ω–æ:** –≤—Å–µ –ª–æ–≥–∏ –ø–æ –º–µ—Å—Ç–∞–º (üî¢ –ú–µ—Å—Ç–∞ –¥–ª—è –∑–∞–∫–∞–∑–∞, –¥–µ—Ç–∞–ª–∏ –ø–æ –∑–∞–¥–∞–Ω–∏—è–º), ¬´–§–û–†–ú–ò–†–û–í–ê–ù–ò–ï –û–¢–í–ï–¢–ê¬ª, ¬´–û–¢–ü–†–ê–í–ö–ê –û–¢–í–ï–¢–ê¬ª, ¬´–§–∏–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω—ã¬ª, ¬´–í–°–ï –ó–ê–î–ê–ù–ò–Ø –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–´¬ª –∏ —Ç.–ø.
- **–û—Å—Ç–∞–≤–ª–µ–Ω–æ:** —Ç–æ–ª—å–∫–æ `console.error` –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö (SSE, –æ–±—â–∞—è –æ—à–∏–±–∫–∞)
- **–§–∞–π–ª:** `src/app/api/shipments/[id]/confirm/route.ts`

### 7. API CREATE (—Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –∏–∑ 1–°)
- **–£–±—Ä–∞–Ω–æ:** –ª–æ–≥–∏ –ø–æ –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏, ¬´–°–æ–∑–¥–∞–µ–º N –∑–∞–¥–∞–Ω–∏–π¬ª, ¬´–ó–∞–¥–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ¬ª, ¬´–§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê¬ª, ¬´–£–°–ü–ï–•¬ª, —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏
- **–û—Å—Ç–∞–≤–ª–µ–Ω–æ:** —Ç–æ–ª—å–∫–æ `console.error` –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö/—Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π (–∞–Ω–æ–º–∞–ª–∏—è)
- **–§–∞–π–ª:** `src/app/api/shipments/route.ts`

### 8. Lock (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∑–∞–¥–∞–Ω–∏—è)
- **–£–±—Ä–∞–Ω–æ:** –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –ª–æ–≥–∏ (–∏—Å—Ç–µ–∫–ª–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞, –æ—Ç–∫–∞–∑, –ø–µ—Ä–µ—Ö–≤–∞—Ç –∞–¥–º–∏–Ω–æ–º, –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)
- **–û—Å—Ç–∞–≤–ª–µ–Ω–æ:** —Ç–æ–ª—å–∫–æ `console.warn` –ø—Ä–∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏ collectorId
- **–§–∞–π–ª:** `src/app/api/shipments/[id]/lock/route.ts`

### 9. Save-confirmation-progress
- **–£–±—Ä–∞–Ω–æ:** –ª–æ–≥ –ø–æ –∫–∞–∂–¥–æ–π –æ–±–Ω–æ–≤–ª—è–µ–º–æ–π –ø–æ–∑–∏—Ü–∏–∏
- **–§–∞–π–ª:** `src/app/api/shipments/[id]/save-confirmation-progress/route.ts`

## –ß—Ç–æ –æ—Å—Ç–∞—ë—Ç—Å—è (–º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω–æ)

- **Sync-1C:** –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ –Ω–∞ –∑–∞–ø—Ä–æ—Å + –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ¬´ready for export: N¬ª; –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø–æ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–º/–Ω–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–º –∑–∞–∫–∞–∑–∞–º; –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ –≤ catch
- **Ready-For-Export:** –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∑–∞–∫–∞–∑–æ–≤; –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ –≤ catch
- **–û—à–∏–±–∫–∏:** –≤—Å–µ `console.error` –ø—Ä–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö (SSE, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è)
- **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:** —Ç–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã–µ (LOCK ‚Äî –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ; Sync-1C ‚Äî –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç, –Ω–µ –Ω–∞–π–¥–µ–Ω –∑–∞–∫–∞–∑, –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–æ–ø–æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ –ø—É—Å—Ç–æ–º—É id)

–ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ `console.log` (—Å—Ç—Ä–∞–Ω–∏—Ü—ã, –º–æ–¥–∞–ª–∫–∏) –Ω–µ —Ç—Ä–æ–≥–∞–ª–∏—Å—å ‚Äî –æ–Ω–∏ –ø–∏—à—É—Ç –≤ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞, –∞ –Ω–µ –≤ `out.log`.
